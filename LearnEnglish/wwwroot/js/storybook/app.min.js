
function getParameterByName(e, t) { t || (t = window.location.href), e = e.replace(/[\[\]]/g, "\\$&"); var i = new RegExp("[?&]" + e + "(=([^&#]*)|&|#|$)").exec(t); return i ? i[2] ? decodeURIComponent(i[2].replace(/\+/g, " ")) : "" : null } var story = (story = getParameterByName("story")).toLowerCase(); grade = "grade" + getParameterByName("grade"); var ebook = getParameterByName("ebook"), allChaptersLink = "/", currentChapterLink = ebook; $(".valijKapitel a")[0].setAttribute("href", allChaptersLink), $(".valijSida a")[0].setAttribute("href", currentChapterLink), $.fn.preload = function () { this.each(function () { $("<iframe/>")[0].src = this }) }; var isOpera = !!window.opera || navigator.userAgent.indexOf(" OPR/") >= 0, isFirefox = "undefined" != typeof InstallTrigger, isSafari = Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor") > 0, isChrome = !!window.chrome && !isOpera, isIE = !!document.documentMode, clickHandler = "ontouchstart" in document.documentElement ? "touchstart" : "click"; function isiPhone() { return -1 != navigator.platform.indexOf("iPhone") ? "iphone" : -1 != navigator.platform.indexOf("iPod") ? "ipod" : -1 != navigator.platform.indexOf("iPad") ? "ipad" : void 0 } clickHandler = "click", isIE && ($("html").addClass("ie" + document.documentMode), IEVersion = document.documentMode), isSafari && $("html").addClass("safari " + isiPhone()); var isiPad = null != navigator.userAgent.match(/iPad/i), currentPage = null, autoPlay = !1, jplayerInitialized = !1, audioEnded = !1, position = "first", jpPlayTime = $("#jplayer_play_time"), jpTotalTime = $("#jplayer_total_time"), jpPlayer = $("#jquery_jplayer"), highlightClass = "highlight", audioStatus = 0, goingToHome = !1; init_jPlayer(); var autoSwitch = !1; function setCurrentPage(e) { (currentPage = e).on("click", ".page-wrapper:not(", function (e) { $(e.target).parent().is(".speakable") || (jpPlayer.jPlayer("stop"), jpPlayer.jPlayer("stop"), audioStatus = 0, this.wordIndex = 0, this.currentWord = 0, audioEnded = !0, removeHighlights(), setTimeout(function () { jpPlayer.jPlayer("stop") }, 100)) }), currentPage.parent().find("#seperator").hide(), currentPage.bind("turning", function (e, t, i) { updateDepth(currentPage, t) }), updateDepth(currentPage, 1) } function updateDepth(e, t) { var i = e.turn("page"), n = e.turn("pages"), r = 16 * Math.min(1, 2 * i / n); currentPage.find(".depth"); t = t || i; var a = document.getElementById("container"), o = window.getComputedStyle(a, null), s = parseInt(o.getPropertyValue("left").replace("px", "")), l = (parseInt(o.getPropertyValue("top").replace("px", "")), parseInt(o.getPropertyValue("width").replace("px", ""))), c = parseInt(o.getPropertyValue("height").replace("px", "")), h = zoomRate; isIE && 9 === IEVersion && (h = 1); var u = s - r + l * h * 1 / 4, d = s + l * h * 3 / 4; t > 3 ? $(".depth.left").css({ width: r, left: s - r, height: (c + .2 * c / 100) * h }) : $(".depth.left").css({ width: 0 }), r = 16 * Math.min(1, 2 * (n - t) / n), t <= n - 3 ? 1 == t && i !== t ? ($(".depth.right").css({ opacity: 0 }), $(".depth.right").animate({ width: r, opacity: 1 }, 3500)) : $(".depth.right").css({ width: r, left: s + l * h, height: (c + .1 * c / 100) * h }) : $(".depth.right").css({ width: 0 }), 1 == t && $(".depth.right").css({ left: d }), t == n && $(".depth.left").css({ left: u }), isiPad && ("1" === t ? screen.height > screen.width ? $(".flipbook").css("marginLeft", "-375px") : $(".flipbook").css("marginLeft", "-200px") : screen.height > screen.width ? $(".flipbook").css("marginLeft", "500px") : ($(".flipbook").css("marginLeft", "200px"), $(".highlightingText").css("position", "absolute"), $(".highlightingText").css("left", "1em"), $(".highlightingText").css("bottom", "2.5em"), $(".highlightingText").css("letter-spacing", "1px"), $(".highlightingText").css("font-size", "1.75em"), $(".highlightingText").css("FONT-FAMILY", "NexaBold"))) } function initStory() { var e = "/js/storybook/Grade3/" + story + "/index.html"; $("#container").append($('<div class="loaderWrapper"><div class="la-ball-spin-clockwise"><div></div><div></div><div></div><div></div><div></div><div></div> <div></div> <div></div></div></div>')), $("#container").append($('<iframe id="storyContent" height="100%" width="100%" style="width:100%;height:100%;overflow:hidden"/>')), $("iframe")[0].src = e } function iframeLoaded() { $(".loaderWrapper").hide(), $("#footerContent").css("visibility", "visible") } $(window).on("resize", function () { currentPage && updateDepth(currentPage, currentPage.turn("page")) }); var FlipWaittime = "den" == story ? 100 : "wetpaint" == story ? 700 : "swap" == story ? 800 : "storm" == story ? 200 : "jacket" == story ? 100 : "scarf" == story ? 800 : "case" == story ? 500 : 1e3; function init_jPlayer() { var e = 0; jpPlayer.jPlayer({ ready: function () { this.element.jPlayer("setFile", "https://majemastoragelive.blob.core.windows.net/learn-english-test/content/audio/" + story + ".mp3", "https://majemastoragelive.blob.core.windows.net/learn-english-test/content/audio/" + story + ".ogg", "https://majemastoragelive.blob.core.windows.net/learn-english-test/content/audio/" + story + ".m4a"), jplayerInitialized = !0 }, swfPath: "../scripts", volume: 100, oggSupport: !0, supplied: "m4a,mp3,ogg", preload: "auto", solution: "flash,html", autoPlay: !0 }).jPlayer("onProgressChange", function (t, i, n, r, a) { flips && currentPage && $.each(flips, function (t, i) { i.page != currentPage.turn("page") && i.range.min < r && (i.range.max > r || "max" == i.range.max) ? (audioStatus = 2, e != i.range.min + "New" && jpPlayer.jPlayer("pause"), e = i.range.min, currentPage.turn("page", i.page), setTimeout(function () { audioStatus = 1, setTimeout(function () { e = i.range.min + "New", jpPlayer.jPlayer("play") }, "storm" == story ? 3e3 : 1e3) }, FlipWaittime)) : i.page == currentPage.turn("pages") && a - 300 < r && "max" == i.range.max && 0 != a && 0 != r && (jpPlayer.jPlayer("stop"), goingToHome || (goingToHome = !0, setTimeout(function () { jpPlayer.jPlayer("stop"), audioStatus = 0, currentPage.turn("page", 1), goingToHome = !1 }, 100))) }), audioEnded = !1, jpPlayer.jPlayer("getData", "diag.isPlaying") }).jPlayer("onSoundComplete", function () { }) } function removeHighlights() { $("#storyContent").contents().find(".highlight").removeClass(highlightClass) } $(".jp-pause").on("click", function () { audioStatus = 2 }), jpPlayer.jPlayer("play"), $(".jp-play").on("click", function () { 2 != audioStatus && jpPlayer.jPlayer("playHeadTime", pageSeek[currentPage.turn("page")].seekTime), audioStatus = 1 }), $(document).on("clicks", "#jplayer_play", function (e) { isPlaying = !0, audioStatus = 1 }), $(".jp-stop").on("click", function () { this.wordIndex = 0, this.currentWord = 0, audioEnded = !0, audioStatus = 0, setTimeout(function () { this.wordIndex = 0, this.currentWord = 0, audioEnded = !0, audioStatus = 0, removeHighlights() }, 300), removeHighlights() }), $(".jp-next").on("click", function () { currentPage.turn("next"), removeHighlights(), jpPlayer.jPlayer("stop"), setTimeout(function () { jpPlayer.jPlayer("stop") }, 300) }), $(".jp-previous").on("click", function () { currentPage.turn("previous"), removeHighlights(), jpPlayer.jPlayer("stop"), setTimeout(function () { jpPlayer.jPlayer("stop") }, 300) }), $(".jp-home").on("click", function () { currentPage.turn("page", 1), jpPlayer.jPlayer("stop"), setTimeout(function () { jpPlayer.jPlayer("stop") }, 300), removeHighlights(), audioStatus = 0 }), $(".jp-caption").on("click", function () { $(this).hasClass("activate") ? (highlightClass = "highlight", $(".jp-caption.deactivate").show()) : (removeHighlights(), highlightClass = "", $(".jp-caption.activate").show()), $(this).hide() }), $(".inactive").on("click", function (e) { e.stopPropagation() }); var Player = function () { var e; this.textcontent = null, this.word = null, this.selectStart = null, this.selectEnd = null, this.selectPlaying = !1, this.currentWord = 0, this.tempWord = null, this.wordIndex = 0, this.timer = null, this.wordTimes = null, this.highlightTimes = null, this.sideselector = "#rightDiv", this.speakableSelector = ".speakable", this.isLeftSide = !1, this.wordTimesLeft = null, this.wordTimesRight = null, this.InitializePlayer = function (t, i, n) { (e = this).sideselector = "#" + i, e.isLeftSide = "left" == i, t && (e.textcontent = $(e.sideselector).contents().find(e.speakableSelector), e.word = e.textcontent.text().split(" "), e.textcontent.text(""), e.wordTimes = t, e.highlightTimes = n, e.isLeftSide ? e.wordTimesLeft = t : e.wordTimesRight = t, e.wrapWords(), e.checkMode(), e.makeSeekable()) }, this.checkMode = function () { clearInterval(e.timer), e.timer = setInterval(e.checkTime, 10) }, this.sumDigits = function (e) { e += ""; var t = 0; for (i = 0; i < e.length; i++)t += parseInt(e.charAt(i)); return t }, this.checkTime = function () { if (0 != audioStatus && 2 != audioStatus && (e.selectEnd, null != e.selectStart && 0 == e.selectPlaying && (jpPlayer.jPlayer("playHeadTime", e.wordTimes[e.selectStart]), e.selectPlaying = !0), e.selectEnd == e.currentWord - 1 && 1 == e.selectPlaying && (jpPlayer.jPlayer("pause"), e.selectPlaying = !1), e.wordTimes.length > 0)) { var t = jpPlayer.jPlayer("getData", "diag.playedTime"); if (e.currentWord != e.tempWord && (e.tempWord = e.currentWord), null == e.highlightTimes[e.currentWord] && e.currentWord < e.wordTimes.length) e.currentWord++; else if (0 == audioEnded && t >= e.highlightTimes[e.currentWord] && (e.currentWord >= e.highlightTimes.length - 1 || t <= e.highlightTimes[e.currentWord + 1])) e.highlightWord(e.currentWord), e.currentWord++; else { for (; t > e.highlightTimes[e.currentWord + 1] && e.currentWord < e.wordTimes.length;)e.currentWord++; for (; t < e.highlightTimes[e.currentWord - 1] && e.currentWord >= 0;)e.currentWord-- } } }, $(document).on("mouseup", this.speakableSelector, function (t) { var i = e.getSelText(); i = new String(i).split(" "); for (var n = 0, r = 0, a = 0, o = 0, s = !1; r < e.word.length;){ for (; e.clean(word[r]) == i[n];){ if (s) { if (n == i.length - 1) return !0, o = r, e.selectStart = a, e.selectEnd = o, $("#selected").show().fadeOut(3e3), !1 } else s = !0, a = r; n++, r++ } n = 0, s = !1, r++ } }), this.roundToDp = function (e, t) { return Math.round(e * Math.pow(10, t)) / Math.pow(10, t) }, this.highlightWord = function (e) { this.removeHighlights(), $("#storyContent").contents().find(this.speakableSelector + " #w-" + e).addClass(highlightClass) }, this.removeHighlights = function () { $("#storyContent").contents().find(".highlight").removeClass(highlightClass) }, this.getSelText = function () { var e = ""; return window.getSelection ? e = window.getSelection() : document.getSelection ? e = document.getSelection() : document.selection && (e = document.selection.createRange().text), e }, this.clean = function (e) { return e.replace("\n", "", "g") }, this.wrapWords = function () { var e = this; $.each(e.word, function (t, i) { e.textcontent.append('<a href="#' + t + '" id="w-' + t + '">' + i + " </a>") }) }, this.makeSeekable = function () { var e = this; $(e.sideselector).contents().on("click", this.speakableSelector + " a", function () { $(".jp-pause").click(), e.timer = null, e.selectStart = null, e.selectEnd = null, e.selectPlaying = !1; var t = $(this).attr("href").replace("#", ""); return e.wordIndex = parseInt(t), e.currentWord = parseInt(t), jpPlayer.jPlayer("playHeadTime", e.wordTimes[t] - 400), e.highlightWord(t), setTimeout(function () { $(".jp-play").click(), e.timer = setInterval(e.checkTime, 10) }, 500), !1 }) } }; function LoadPlayer(e, t, i, n) { var r = new Player; r.speakableSelector = i, r.InitializePlayer(e, t, n), "left" == t && curRP > 1 ? (removeHighlights(), jpPlayer.jPlayer("playHeadTime", e[0] - 300), 0 != audioStatus && 2 != audioStatus || jpPlayer.jPlayer("pause"), removeHighlights()) : 1 == curRP && (jpPlayer.jPlayer("stop"), removeHighlights(), audioStatus = 0), removeHighlights() } function NoClickDelay(e) { this.element = "object" == typeof e ? e : document.getElementById(e), window.Touch && this.element.addEventListener("touchstart", this, !1) } initStory(), makeAjaxPage("html", 8, 944, 1091, "", ".png", "../Content/storybooks/" + grade + "/" + story + "/"), String.prototype.replaceAt = function (e, t) { return this.substr(0, e) + t + this.substr(e + 1) }, String.prototype.stripTags = function () { return this.replace(/(<([^>]+)>)/gi, "") }, NoClickDelay.prototype = { handleEvent: function (e) { switch (e.type) { case "touchstart": this.onTouchStart(e); break; case "touchmove": this.onTouchMove(e); break; case "touchend": this.onTouchEnd(e) } }, onTouchStart: function (e) { e.preventDefault(), this.moved = !1, this.x = e.targetTouches[0].clientX, this.y = e.targetTouches[0].clientY, this.theTarget = document.elementFromPoint(this.x, this.y), 3 == this.theTarget.nodeType && (this.theTarget = theTarget.parentNode), this.theTarget.className += " hover", this.element.addEventListener("touchmove", this, !1), this.element.addEventListener("touchend", this, !1); var t = document.createEvent("MouseEvents"); t.initEvent("mousedown", !0, !0), this.theTarget.dispatchEvent(t) }, onTouchMove: function (e) { var t = e.targetTouches[0].clientX, i = e.targetTouches[0].clientY; Math.sqrt(Math.pow(t - this.x, 2) + Math.pow(i - this.y, 2)) > 50 ? (this.moved = !0, this.theTarget.className = this.theTarget.className.replace(/ hover/gi, "")) : 1 == this.moved && (this.moved = !1, this.theTarget.className += " hover") }, onTouchEnd: function (e) { if (this.element.removeEventListener("touchmove", this, !1), this.element.removeEventListener("touchend", this, !1), !this.moved && this.theTarget) { this.theTarget.className = this.theTarget.className.replace(/ hover/gi, ""); var t = document.createEvent("MouseEvents"); t.initEvent("click", !0, !0), this.theTarget.dispatchEvent(t), (t = document.createEvent("MouseEvents")).initEvent("mouseup", !0, !0), this.theTarget.dispatchEvent(t) } this.theTarget = void 0 } }, NoClickDelay.prototype.offset = function () { var e = _y = 0, t = document; if (t.offsetParent) do { e += t.offsetLeft, _y += t.offsetTop } while (t = t.offsetParent); return { x: e, y: _y } }; var appInsights = window.appInsights || function (e) { function t(e) { r[e] = function () { var t = arguments; r.queue.push(function () { r[e].apply(r, t) }) } } var i, n, r = { config: e }, a = document, o = window, s = "script", l = "AuthenticatedUserContext", c = "start", h = "stop", u = "Track", d = u + "Event", g = u + "Page", p = a.createElement(s); p.src = e.url || "https://az416426.vo.msecnd.net/scripts/a/ai.0.js", a.getElementsByTagName(s)[0].parentNode.appendChild(p); try { r.cookie = a.cookie } catch (e) { } for (r.queue = [], r.version = "1.0", i = ["Event", "Exception", "Metric", "PageView", "Trace", "Dependency"]; i.length;)t("track" + i.pop()); return t("set" + l), t("clear" + l), t(c + d), t(h + d), t(c + g), t(h + g), t("flush"), e.disableExceptionTracking || (t("_" + (i = "onerror")), n = o[i], o[i] = function (e, t, a, o, s) { var l = n && n(e, t, a, o, s); return !0 !== l && r["_" + i](e, t, a, o, s), l }), r }({ instrumentationKey: "524cd669-32d5-4f89-bcce-727a8209a0f4" }); window.appInsights = appInsights, appInsights.trackPageView(), $.each($("a"), function (e, t) { null != this && $(this).on("click", function (e) { e = "Name: " + ("Anchor_" + e.currentTarget.text) + "; URL: " + window.location.href; appInsights.trackEvent(e) }) }), setTimeout(function () { for (var e = document.getElementById("storyContent"), t = (e.contentDocument ? e.contentDocument : e.contentWindow.document).getElementsByTagName("a"), i = 0; i < t.length; i++)$(t[i]).on("click", function (e) { e = "Name: " + ("Story_Txt_" + e.currentTarget.innerText) + "; URL: " + window.location.href; appInsights.trackEvent(e) }) }, 5e3);