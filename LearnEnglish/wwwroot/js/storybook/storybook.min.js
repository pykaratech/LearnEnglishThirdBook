var ratio = 16 / 9, el = document.getElementById("storyBook"), currentPage = null, isiPad = null != navigator.userAgent.match(/iPad/i); function loadApp() { currentPage = $(".flipbook").turn({ width: 1024, height: 768, elevation: 100, gradients: !0, autoCenter: !0, acceleration: !0, duration: 2e3 }); resize(el); window.addEventListener("resize", function (e) { resize(el) }), loadPlayer() } function loadPlayer() { var e = window.parent; e.setCurrentPage(currentPage); for (var t = [], i = 1; i < pages.length; i++)e.LoadPlayer(pages[i], "storyContent", ".speakable.page" + i, HighlightText[i]), $.each(pages[i], function (e, i) { t.push(i) }); e.iframeLoaded() } function resize(e) { e.style.width = "", e.style.height = ""; var t = e.clientWidth, i = Math.round(t / ratio), n = Math.round(.9 * document.body.clientHeight); i > n && (i = n, t = Math.round(i * ratio)), i = document.body.clientHeight < $(window).height() ? $(window).height() : document.body.clientHeight, t = document.body.clientWidth < $(window).width() ? $(window).width() : document.body.clientWidth, isiPad && (i = 1091, t = 1885), e.style.width = t + "px", e.style.height = i + "px", $(".flipbook").turn("size", t, i) } yepnope({ test: Modernizr.csstransforms, nope: ["../../lib/turn.html4.min.js"], both: ["../css/stories.css", "css/basic.css"], complete: loadApp });