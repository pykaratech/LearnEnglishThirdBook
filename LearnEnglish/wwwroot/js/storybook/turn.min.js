(function(n){"use strict";function nt(n,t,i){if(i[0]&&typeof i[0]!="object"){if(t[i[0]])return t[i[0]].apply(n,Array.prototype.slice.call(i,1));throw e(i[0]+" is not a method or property");}else return t.init.apply(n,i)}function f(n,t,i,r){return{css:{position:"absolute",top:n,left:t,overflow:r||"hidden",zIndex:i||"auto"}}}function tt(n,t,i,u,f){var e=1-f,o=e*e*e,s=f*f*f;return r(Math.round(o*n.x+3*f*e*e*t.x+3*f*f*e*i.x+s*u.x),Math.round(o*n.y+3*f*e*e*t.y+3*f*f*e*i.y+s*u.y))}function st(n){return n/c*180}function r(n,t){return{x:n,y:t}}function ht(){var n,t;return(n=/AppleWebkit\/([0-9\.]+)/i.exec(navigator.userAgent))?(t=parseFloat(n[1]),t>534.3):!0}function a(n,t,i){return w&&i?" translate3d("+n+"px,"+t+"px, 0px) ":" translate("+n+"px, "+t+"px) "}function v(n){return" rotate("+n+"deg) "}function u(n,t){return Object.prototype.hasOwnProperty.call(t,n)}function it(){for(var n=["Moz","Webkit","Khtml","O","ms"],t=n.length,i="";t--;)n[t]+"Transform"in document.body.style&&(i="-"+n[t].toLowerCase()+"-");return i}function ct(){var n,i=document.createElement("fakeelement"),t={transition:"transitionend",OTransition:"oTransitionEnd",MSTransition:"transitionend",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(n in t)if(i.style[n]!==undefined)return t[n]}function k(n,t,i,u,f){var e,s=[];if(o=="-webkit-"){for(e=0;e<f;e++)s.push("color-stop("+u[e][0]+", "+u[e][1]+")");n.css({"background-image":"-webkit-gradient(linear, "+t.x+"% "+t.y+"%,"+i.x+"% "+i.y+"%, "+s.join(",")+" )"})}else{t={x:t.x/100*n.width(),y:t.y/100*n.height()};i={x:i.x/100*n.width(),y:i.y/100*n.height()};var l=i.x-t.x,a=i.y-t.y,v=Math.atan2(a,l),p=v-Math.PI/2,k=Math.abs(n.width()*Math.sin(p))+Math.abs(n.height()*Math.cos(p)),d=Math.sqrt(a*a+l*l),h=r(i.x<t.x?n.width():0,i.y<t.y?n.height():0),y=Math.tan(v),c=-1/y,w=(c*h.x-h.y-y*t.x+t.y)/(c-y),b={x:w,y:c*w-c*h.x+h.y},g=Math.sqrt(Math.pow(b.x-t.x,2)+Math.pow(b.y-t.y,2));for(e=0;e<f;e++)s.push(" "+u[e][1]+" "+(g+d*u[e][0])*100/k+"%");n.css({"background-image":o+"linear-gradient("+-v+"rad,"+s.join(",")+")"})}}function y(t,i,r){var u=n.Event(t);return i.trigger(u,r),u.isDefaultPrevented()?"prevented":u.isPropagationStopped()?"stopped":""}function e(n){function t(n){this.name="TurnJsError";this.message=n}return t.prototype=new Error,t.prototype.constructor=t,new t(n)}function d(n){var t={top:0,left:0};do t.left+=n.offsetLeft,t.top+=n.offsetTop;while(n=n.offsetParent);return t}function lt(){return navigator.userAgent.indexOf("MSIE 9.0")==-1}var w,g,o="",rt="4.1.0",c=Math.PI,p=c/2,l="ontouchstart"in window,h=l?{down:"touchstart",move:"touchmove",up:"touchend",over:"touchstart",out:"touchend"}:{down:"mousedown",move:"mousemove",up:"mouseup",over:"mouseover",out:"mouseout"},s={backward:["bl","tl"],forward:["br","tr"],all:["tl","bl","tr","br","l","r"]},ut=["single","double"],ft=["ltr","rtl"],et={acceleration:!0,display:"double",duration:600,page:1,gradients:!0,turnCorners:"bl,br",when:null},ot={cornerSize:100},b=600,t={init:function(i){w="WebKitCSSMatrix"in window||"MozPerspective"in document.body.style;g=ht();o=it();var f,c=this,s=0,r=this.data(),e=this.children();if(i=n.extend({width:this.width(),height:this.height(),direction:this.attr("dir")||this.css("direction")||"ltr"},et,i),r.opts=i,r.pageObjs={},r.pages={},r.pageWrap={},r.pageZoom={},r.pagePlace={},r.pageMv=[],r.zoom=1,r.totalPages=i.pages||0,r.eventHandlers={touchStart:n.proxy(t._touchStart,this),touchMove:n.proxy(t._touchMove,this),touchEnd:n.proxy(t._touchEnd,this),start:n.proxy(t._eventStart,this)},i.when)for(f in i.when)u(f,i.when)&&this.bind(f,i.when[f]);for(this.css({position:"relative",width:i.width,height:i.height}),this.turn("display",i.display),i.direction!==""&&this.turn("direction",i.direction),w&&!l&&i.acceleration&&this.transform(a(0,0,!0)),f=0;f<e.length;f++)n(e[f]).attr("ignore")!="1"&&this.turn("addPage",e[f],++s);return n(this).bind(h.down,r.eventHandlers.touchStart).bind("end",t._eventEnd).bind("pressed",t._eventPressed).bind("released",t._eventReleased).bind("flip",t._flip),n(this).parent().bind("start",r.eventHandlers.start),n(document).bind(h.move,r.eventHandlers.touchMove).bind(h.up,r.eventHandlers.touchEnd),this.turn("page",i.page),r.done=!0,this},addPage:function(i,r){var s,h,o=!1,u=this.data(),f=u.totalPages+1;if(u.destroying)return!1;if((s=/\bp([0-9]+)\b/.exec(n(i).attr("class")))&&(r=parseInt(s[1],10)),r){if(r==f)o=!0;else if(r>f)throw e('Page "'+r+'" cannot be inserted');}else r=f,o=!0;return r>=1&&r<=f&&(h=u.display=="double"?r%2?" odd":" even":"",u.done&&this.turn("stop"),r in u.pageObjs&&t._movePages.call(this,r,1),o&&(u.totalPages=f),u.pageObjs[r]=n(i).css({float:"left"}).addClass("page p"+r+h),!lt()&&u.pageObjs[r].hasClass("hard")&&u.pageObjs[r].removeClass("hard"),t._addPage.call(this,r),t._removeFromDOM.call(this)),this},_addPage:function(i){var r=this.data(),f=r.pageObjs[i],u;f&&(t._necessPage.call(this,i)?(r.pageWrap[i]||(r.pageWrap[i]=n("<div/>",{"class":"page-wrapper",page:i,css:{position:"absolute",overflow:"hidden"}}),this.append(r.pageWrap[i]),r.pagePlace[i]||(r.pagePlace[i]=i,r.pageObjs[i].appendTo(r.pageWrap[i])),u=t._pageSize.call(this,i,!0),f.css({width:u.width,height:u.height}),r.pageWrap[i].css(u)),r.pagePlace[i]==i&&t._makeFlip.call(this,i)):(r.pagePlace[i]=0,r.pageObjs[i]&&r.pageObjs[i].remove()))},hasPage:function(n){return u(n,this.data().pageObjs)},center:function(t){var i=this.data(),f=n(this).turn("size"),r=0,e=navigator.userAgent.match(/iPad/i)!=null,u;return i.noCenter||(i.display=="double"&&(u=this.turn("view",t||i.tpage||i.page),i.direction=="ltr"?u[0]?u[1]||(r+=f.width/4):r-=f.width/4:u[0]?u[1]||(r-=f.width/4):r+=f.width/4),n(this).css({marginLeft:r})),this},destroy:function(){var i=this,t=this.data();if(y("destroying",this)!="prevented"){for(t.destroying=!0,n.each(["end","first","flip","last","pressed","released","start","turning","turned","zooming","missing"],function(n,t){i.unbind(t)}),this.parent().unbind("start",t.eventHandlers.start),n(document).unbind(h.move,t.eventHandlers.touchMove).unbind(h.up,t.eventHandlers.touchEnd);t.totalPages!==0;)this.turn("removePage",t.totalPages);return t.fparent&&t.fparent.remove(),t.shadow&&t.shadow.remove(),this.removeData(),t=null,this}},is:function(){return typeof this.data().pages=="object"},zoom:function(i){var r=this.data(),u;if(typeof i=="number"){if(i<.001||i>100)throw e(i+" is not a value for zoom");if(y("zooming",this,[i,r.zoom])=="prevented")return this;var o=this.turn("size"),f=this.turn("view"),s=1/r.zoom,h=Math.round(o.width*s*i),c=Math.round(o.height*s*i);for(r.zoom=i,n(this).turn("stop").turn("size",h,c),r.opts.autoCenter&&this.turn("center"),t._updateShadow.call(this),u=0;u<f.length;u++)f[u]&&r.pageZoom[f[u]]!=r.zoom&&(this.trigger("zoomed",[f[u],f,r.pageZoom[f[u]],r.zoom]),r.pageZoom[f[u]]=r.zoom);return this}return r.zoom},_pageSize:function(n,t){var o=navigator.userAgent.match(/iPad/i)!=null,r=this.data(),i={},f,e,u;return r.display=="single"?(i.width=this.width(),i.height=this.height(),t&&(i.top=0,i.left=0,i.right="auto")):(f=this.width()/2,e=this.height(),r.pageObjs[n].hasClass("own-size")?(i.width=r.pageObjs[n].width(),i.height=r.pageObjs[n].height()):(i.width=f,i.height=e),t&&(u=n%2,i.top=(e-i.height)/2,r.direction=="ltr"?(i[u?"right":"left"]=f-i.width,i[u?"left":"right"]="auto"):(i[u?"left":"right"]=f-i.width,i[u?"right":"left"]="auto"))),i},_makeFlip:function(n){var i=this.data(),r,u;return i.pages[n]||i.pagePlace[n]!=n||(r=i.display=="single",u=n%2,i.pages[n]=i.pageObjs[n].css(t._pageSize.call(this,n)).flip({page:n,next:u||r?n+1:n-1,turn:this}).flip("disable",i.disabled),t._setPageLoc.call(this,n),i.pageZoom[n]=i.zoom),i.pages[n]},_makeRange:function(){var n,i,r=this.data();if(!(r.totalPages<1))for(i=this.turn("range"),n=i[0];n<=i[1];n++)t._addPage.call(this,n)},range:function(n){var u,f,o,i,r=this.data();if(n=n||r.tpage||r.page||1,i=t._view.call(this,n),n<1||n>r.totalPages)throw e('"'+n+'" is not a valid page');return i[1]=i[1]||i[0],i[0]>=1&&i[1]<=r.totalPages?(u=Math.floor((b-2)/2),r.totalPages-i[1]>i[0]?(f=Math.min(i[0]-1,u),o=2*u-f):(o=Math.min(r.totalPages-i[1],u),f=2*u-o)):(f=b-1,o=b-1),[Math.max(1,i[0]-f),Math.min(r.totalPages,i[1]+o)]},_necessPage:function(n){if(n===0)return!0;var t=this.turn("range");return this.data().pageObjs[n].hasClass("fixed")||n>=t[0]&&n<=t[1]},_removeFromDOM:function(){var n,i=this.data();for(n in i.pageWrap)u(n,i.pageWrap)&&!t._necessPage.call(this,n)&&t._removePageFromDOM.call(this,n)},_removePageFromDOM:function(n){var r=this.data(),u;r.pages[n]&&(u=r.pages[n].data(),i._moveFoldingPage.call(r.pages[n],!1),u.f&&u.f.fwrapper&&u.f.fwrapper.remove(),r.pages[n].removeData(),r.pages[n].remove(),delete r.pages[n]);r.pageObjs[n]&&r.pageObjs[n].remove();r.pageWrap[n]&&(r.pageWrap[n].remove(),delete r.pageWrap[n]);t._removeMv.call(this,n);delete r.pagePlace[n];delete r.pageZoom[n]},removePage:function(n){var i=this.data();if(n=="*")while(i.totalPages!==0)this.turn("removePage",i.totalPages);else{if(n<1||n>i.totalPages)throw e("The page "+n+" doesn't exist");i.pageObjs[n]&&(this.turn("stop"),t._removePageFromDOM.call(this,n),delete i.pageObjs[n]);t._movePages.call(this,n,-1);i.totalPages=i.totalPages-1;i.page>i.totalPages?(i.page=null,t._fitPage.call(this,i.totalPages)):(t._makeRange.call(this),this.turn("update"))}return this},_movePages:function(n,i){var u,e=this,r=this.data(),o=r.display=="single",f=function(n){var u=n+i,f=u%2,s=f?" odd ":" even ";r.pageObjs[n]&&(r.pageObjs[u]=r.pageObjs[n].removeClass("p"+n+" odd even").addClass("p"+u+s));r.pagePlace[n]&&r.pageWrap[n]&&(r.pagePlace[u]=u,r.pageWrap[u]=r.pageObjs[u].hasClass("fixed")?r.pageWrap[n].attr("page",u):r.pageWrap[n].css(t._pageSize.call(e,u,!0)).attr("page",u),r.pages[n]&&(r.pages[u]=r.pages[n].flip("options",{page:u,next:o||f?u+1:u-1})),i&&(delete r.pages[n],delete r.pagePlace[n],delete r.pageZoom[n],delete r.pageObjs[n],delete r.pageWrap[n]))};if(i>0)for(u=r.totalPages;u>=n;u--)f(u);else for(u=n;u<=r.totalPages;u++)f(u)},display:function(i){var r=this.data(),f=r.display,u;if(i===undefined)return f;if(n.inArray(i,ut)==-1)throw e('"'+i+'" is not a value for display');switch(i){case"single":r.pageObjs[0]||(this.turn("stop").css({overflow:"hidden"}),r.pageObjs[0]=n("<div />",{"class":"page p-temporal"}).css({width:this.width(),height:this.height()}).appendTo(this));this.addClass("shadow");break;case"double":r.pageObjs[0]&&(this.turn("stop").css({overflow:""}),r.pageObjs[0].remove(),delete r.pageObjs[0]);this.removeClass("shadow")}return r.display=i,f&&(u=this.turn("size"),t._movePages.call(this,1,0),this.turn("size",u.width,u.height).turn("update")),this},direction:function(t){var i=this.data();if(t===undefined)return i.direction;if(t=t.toLowerCase(),n.inArray(t,ft)==-1)throw e('"'+t+'" is not a value for direction');return t=="rtl"&&n(this).attr("dir","ltr").css({direction:"ltr"}),i.direction=t,i.done&&this.turn("size",n(this).width(),n(this).height()),this},animating:function(){return this.data().pageMv.length>0},corner:function(){var i,n,t=this.data();for(n in t.pages)if(u(n,t.pages)&&(i=t.pages[n].flip("corner")))return i;return!1},data:function(){return this.data()},disable:function(t){var r,i=this.data(),f=this.turn("view");i.disabled=t===undefined||t===!0;for(r in i.pages)u(r,i.pages)&&i.pages[r].flip("disable",i.disabled?!0:n.inArray(parseInt(r,10),f)==-1);return this},disabled:function(n){return n===undefined?this.data().disabled===!0:this.turn("disable",n)},size:function(n,i){if(n===undefined||i===undefined)return{width:this.width(),height:this.height()};this.turn("stop");var f,e,r=this.data(),o=r.display=="double"?n/2:n;this.css({width:n,height:i});r.pageObjs[0]&&r.pageObjs[0].css({width:o,height:i});for(f in r.pageWrap)u(f,r.pageWrap)&&(e=t._pageSize.call(this,f,!0),r.pageObjs[f].css({width:e.width,height:e.height}),r.pageWrap[f].css(e),r.pages[f]&&r.pages[f].css({width:e.width,height:e.height}));return this.turn("resize"),this},resize:function(){var i,n=this.data();for(n.pages[0]&&(n.pageWrap[0].css({left:-this.width()}),n.pages[0].flip("resize",!0)),i=1;i<=n.totalPages;i++)n.pages[i]&&n.pages[i].flip("resize",!0);t._updateShadow.call(this);n.opts.autoCenter&&this.turn("center")},_removeMv:function(n){for(var i=this.data(),t=0;t<i.pageMv.length;t++)if(i.pageMv[t]==n)return i.pageMv.splice(t,1),!0;return!1},_addMv:function(n){var i=this.data();t._removeMv.call(this,n);i.pageMv.push(n)},_view:function(n){var t=this.data();return n=n||t.page,t.display=="double"?n%2?[n-1,n]:[n,n+1]:[n]},view:function(n){var r=this.data(),i=t._view.call(this,n);return r.display=="double"?[i[0]>0?i[0]:0,i[1]<=r.totalPages?i[1]:0]:[i[0]>0&&i[0]<=r.totalPages?i[0]:0]},stop:function(n,t){if(this.turn("animating")){var f,u,e,r=this.data();for(r.tpage&&(r.page=r.tpage,delete r.tpage),f=0;f<r.pageMv.length;f++)r.pageMv[f]&&r.pageMv[f]!==n&&(e=r.pages[r.pageMv[f]],u=e.data().f.opts,e.flip("hideFoldedPage",t),t||i._moveFoldingPage.call(e,!1),u.force&&(u.next=u.page%2==0?u.page-1:u.page+1,delete u.force))}return this.turn("update"),this},pages:function(n){var i=this.data(),r;if(n){if(n<i.totalPages)for(r=i.totalPages;r>n;r--)this.turn("removePage",r);return i.totalPages=n,t._fitPage.call(this,i.page),this}return i.totalPages},_missing:function(n){var u=this.data(),t,r,i;if(!(u.totalPages<1)){for(r=this.turn("range",n),i=[],t=r[0];t<=r[1];t++)u.pageObjs[t]||i.push(t);i.length>0&&this.trigger("missing",[i])}},_fitPage:function(n){var i=this.data(),r=this.turn("view",n),u;if(t._missing.call(this,n),i.pageObjs[n]){for(i.page=n,this.turn("stop"),u=0;u<r.length;u++)r[u]&&i.pageZoom[r[u]]!=i.zoom&&(this.trigger("zoomed",[r[u],r,i.pageZoom[r[u]],i.zoom]),i.pageZoom[r[u]]=i.zoom);t._removeFromDOM.call(this);t._makeRange.call(this);t._updateShadow.call(this);this.trigger("turned",[n,r]);this.turn("update");i.opts.autoCenter&&this.turn("center")}},_turnPage:function(i){var u,e,r=this.data(),c=r.pagePlace[i],f=this.turn("view"),o=this.turn("view",i),l;if(r.page!=i){if(l=r.page,y("turning",this,[i,o])=="prevented"){l==r.page&&n.inArray(c,r.pageMv)!=-1&&r.pages[c].flip("hideFoldedPage",!0);return}n.inArray(1,o)!=-1&&this.trigger("first");n.inArray(r.totalPages,o)!=-1&&this.trigger("last")}r.display=="single"?(u=f[0],e=o[0]):f[1]&&i>f[1]?(u=f[1],e=o[0]):f[0]&&i<f[0]&&(u=f[0],e=o[1]);var a=r.opts.turnCorners.split(","),s=r.pages[u].data().f,h=s.opts,v=s.point;(t._missing.call(this,i),r.pageObjs[i])&&(this.turn("stop"),r.page=i,t._makeRange.call(this),r.tpage=e,h.next!=e&&(h.next=e,h.force=!0),this.turn("update"),s.point=v,s.effect=="hard"?r.direction=="ltr"?r.pages[u].flip("turnPage",i>u?"r":"l"):r.pages[u].flip("turnPage",i>u?"l":"r"):r.direction=="ltr"?r.pages[u].flip("turnPage",a[i>u?1:0]):r.pages[u].flip("turnPage",a[i>u?0:1]))},page:function(i){var r=this.data();if(i===undefined)return r.page;if(!r.disabled&&!r.destroying){if(i=parseInt(i,10),i>0&&i<=r.totalPages)return i!=r.page&&(r.done&&n.inArray(i,this.turn("view"))==-1?t._turnPage.call(this,i):t._fitPage.call(this,i)),this;throw e("The page "+i+" does not exist");}},next:function(){return this.turn("page",Math.min(this.data().totalPages,t._view.call(this,this.data().page).pop()+1))},previous:function(){return this.turn("page",Math.max(1,t._view.call(this,this.data().page).shift()-1))},peel:function(n,t){var i=this.data(),r=this.turn("view"),u;return t=t===undefined?!0:t===!0,n===!1?this.turn("stop",null,t):i.display=="single"?i.pages[i.page].flip("peel",n,t):(u=i.direction=="ltr"?n.indexOf("l")!=-1?r[0]:r[1]:n.indexOf("l")!=-1?r[1]:r[0],i.pages[u]&&i.pages[u].flip("peel",n,t)),this},_addMotionPage:function(){var i=n(this).data().f.opts,r=i.turn,u=r.data();t._addMv.call(r,i.page)},_eventStart:function(n,i,r){var u=i.turn.data(),f=u.pageZoom[i.page];if(n.isDefaultPrevented()){t._updateShadow.call(i.turn);return}f&&f!=u.zoom&&(i.turn.trigger("zoomed",[i.page,i.turn.turn("view",i.page),f,u.zoom]),u.pageZoom[i.page]=u.zoom);u.display=="single"&&r&&(r.charAt(1)=="l"&&u.direction=="ltr"||r.charAt(1)=="r"&&u.direction=="rtl"?(i.next=i.next<i.page?i.next:i.page-1,i.force=!0):i.next=i.next>i.page?i.next:i.page+1);t._addMotionPage.call(n.target);t._updateShadow.call(i.turn)},_eventEnd:function(i,r,u){var s=n(i.target),h=s.data().f,f=r.turn,o=f.data(),e;u?(e=o.tpage||o.page,(e==r.next||e==r.page)&&(delete o.tpage,t._fitPage.call(f,e||r.next,!0))):(t._removeMv.call(f,r.page),t._updateShadow.call(f),f.turn("update"))},_eventPressed:function(t){var i=n(t.target).data().f,r=i.opts.turn,u=r.data(),f=u.pages;return u.mouseAction=!0,r.turn("update"),i.time=(new Date).getTime()},_eventReleased:function(i,r){var e,u=n(i.target),f=u.data().f,o=f.opts.turn,s=o.data();e=s.display=="single"?r.corner=="br"||r.corner=="tr"?r.x<u.width()/2:r.x>u.width()/2:r.x<0||r.x>u.width();((new Date).getTime()-f.time<200||e)&&(i.preventDefault(),t._turnPage.call(o,f.opts.next));s.mouseAction=!1},_flip:function(t){t.stopPropagation();var i=n(t.target).data().f.opts;i.turn.trigger("turn",[i.next]);i.turn.data().opts.autoCenter&&i.turn.turn("center",i.next)},_touchStart:function(){var n=this.data();for(var t in n.pages)if(u(t,n.pages)&&i._eventStart.apply(n.pages[t],arguments)===!1)return!1},_touchMove:function(){var n=this.data();for(var t in n.pages)u(t,n.pages)&&i._eventMove.apply(n.pages[t],arguments)},_touchEnd:function(){var n=this.data();for(var t in n.pages)u(t,n.pages)&&i._eventEnd.apply(n.pages[t],arguments)},calculateZ:function(n){for(var i,r,o,e,l=this,u=this.data(),s=this.turn("view"),a=s[0]||s[1],h=n.length-1,f={pageZ:{},partZ:{},pageV:{}},c=function(n){var t=l.turn("view",n);t[0]&&(f.pageV[t[0]]=!0);t[1]&&(f.pageV[t[1]]=!0)},t=0;t<=h;t++)i=n[t],r=u.pages[i].data().f.opts.next,o=u.pagePlace[i],c(i),c(r),e=u.pagePlace[r]==r?r:i,f.pageZ[e]=u.totalPages-Math.abs(a-e),f.partZ[o]=u.totalPages*2-h+t;return f},update:function(){var i,r=this.data(),c;if(this.turn("animating")&&r.pageMv[0]!==0){var f,o,e=this.turn("calculateZ",r.pageMv),l=this.turn("corner"),s=this.turn("view"),h=this.turn("view",r.tpage);for(i in r.pageWrap)u(i,r.pageWrap)&&(o=r.pageObjs[i].hasClass("fixed"),r.pageWrap[i].css({display:e.pageV[i]||o?"":"none",zIndex:(r.pageObjs[i].hasClass("hard")?e.partZ[i]:e.pageZ[i])||(o?-1:0)}),(f=r.pages[i])&&(f.flip("z",e.partZ[i]||null),e.pageV[i]&&f.flip("resize"),r.tpage?f.flip("hover",!1).flip("disable",n.inArray(parseInt(i,10),r.pageMv)==-1&&i!=h[0]&&i!=h[1]):f.flip("hover",l===!1).flip("disable",i!=s[0]&&i!=s[1])))}else for(i in r.pageWrap)u(i,r.pageWrap)&&(c=t._setPageLoc.call(this,i),r.pages[i]&&r.pages[i].flip("disable",r.disabled||c!=1).flip("hover",!0).flip("z",null));return this},_updateShadow:function(){var i,u,h,t=this.data(),e=this.width(),o=this.height(),s=t.display=="single"?e:e/2,r;for(i=this.turn("view"),t.shadow||(t.shadow=n("<div />",{"class":"shadow",css:f(0,0,0).css}).appendTo(this)),r=0;r<t.pageMv.length;r++){if(!i[0]||!i[1])break;i=this.turn("view",t.pages[t.pageMv[r]].data().f.opts.next);u=this.turn("view",t.pageMv[r]);i[0]=i[0]&&u[0];i[1]=i[1]&&u[1]}h=i[0]?i[1]?3:t.direction=="ltr"?2:1:t.direction=="ltr"?1:2;switch(h){case 1:t.shadow.css({width:s,height:o,top:0,left:s});break;case 2:t.shadow.css({width:s,height:o,top:0,left:0});break;case 3:t.shadow.css({width:e,height:o,top:0,left:0})}},_setPageLoc:function(n){var t=this.data(),i=this.turn("view"),r=0;if(n==i[0]||n==i[1]?r=1:(t.display=="single"&&n==i[0]+1||t.display=="double"&&n==i[0]-2||n==i[1]+2)&&(r=2),!this.turn("animating"))switch(r){case 1:t.pageWrap[n].css({zIndex:t.totalPages,display:""});break;case 2:t.pageWrap[n].css({zIndex:t.totalPages-1,display:""});break;case 0:t.pageWrap[n].css({zIndex:0,display:t.pageObjs[n].hasClass("fixed")?"":"none"})}return r},options:function(t){var r,i;if(t===undefined)return this.data().opts;if(r=this.data(),n.extend(r.opts,t),t.pages&&this.turn("pages",t.pages),t.page&&this.turn("page",t.page),t.display&&this.turn("display",t.display),t.direction&&this.turn("direction",t.direction),t.width&&t.height&&this.turn("size",t.width,t.height),t.when)for(i in t.when)u(i,t.when)&&this.unbind(i).bind(i,t.when[i]);return this},version:function(){return rt}},i={init:function(n){return this.data({f:{disabled:!1,hover:!1,effect:this.hasClass("hard")?"hard":"sheet"}}),this.flip("options",n),i._addPageWrapper.call(this),this},setData:function(t){var i=this.data();return i.f=n.extend(i.f,t),this},options:function(t){var r=this.data().f;return t?(i.setData.call(this,{opts:n.extend({},r.opts||ot,t)}),this):r.opts},z:function(n){var t=this.data().f;return t.opts["z-index"]=n,t.fwrapper&&t.fwrapper.css({zIndex:n||parseInt(t.parent.css("z-index"),10)||0}),this},_cAllowed:function(){var i=this.data().f,r=i.opts.page,n=i.opts.turn.data(),t=r%2;return i.effect=="hard"?n.direction=="ltr"?[t?"r":"l"]:[t?"l":"r"]:n.display=="single"?r==1?n.direction=="ltr"?s.forward:s.backward:r==n.totalPages?n.direction=="ltr"?s.backward:s.forward:s.all:n.direction=="ltr"?s[t?"forward":"backward"]:s[t?"backward":"forward"]},_cornerActivated:function(t){var e=this.data().f,f=this.width(),o=this.height(),r={x:t.x,y:t.y,corner:""},u=e.opts.cornerSize,s;if(r.x<=0||r.y<=0||r.x>=f||r.y>=o)return!1;s=i._cAllowed.call(this);switch(e.effect){case"hard":if(r.x>f-u)r.corner="r";else if(r.x<u)r.corner="l";else return!1;break;case"sheet":if(r.y<u)r.corner+="t";else if(r.y>=o-u)r.corner+="b";else return!1;if(r.x<=u)r.corner+="l";else if(r.x>=f-u)r.corner+="r";else return!1}return!r.corner||n.inArray(r.corner,s)==-1?!1:r},_isIArea:function(n){var t=this.data().f.parent.offset();return n=l&&n.originalEvent?n.originalEvent.touches[0]:n,i._cornerActivated.call(this,{x:n.pageX-t.left,y:n.pageY-t.top})},_c:function(n,t){t=t||0;switch(n){case"tl":return r(t,t);case"tr":return r(this.width()-t,t);case"bl":return r(t,this.height()-t);case"br":return r(this.width()-t,this.height()-t);case"l":return r(t,0);case"r":return r(this.width()-t,0)}},_c2:function(n){switch(n){case"tl":return r(this.width()*2,0);case"tr":return r(-this.width(),0);case"bl":return r(this.width()*2,this.height());case"br":return r(-this.width(),this.height());case"l":return r(this.width()*2,0);case"r":return r(-this.width(),0)}},_foldingPage:function(){var n=this.data().f,t;if(n)return t=n.opts,t.turn?(n=t.turn.data(),n.display=="single"?t.next>1||t.page>1?n.pageObjs[0]:null:n.pageObjs[t.next]):void 0},_backGradient:function(){var t=this.data().f,i=t.opts.turn.data(),r=i.opts.gradients&&(i.display=="single"||t.opts.page!=2&&t.opts.page!=i.totalPages-1);return r&&!t.bshadow&&(t.bshadow=n("<div/>",f(0,0,1)).css({position:"",width:this.width(),height:this.height()}).appendTo(t.parent)),r},type:function(){return this.data().f.effect},resize:function(n){var t=this.data().f,o=t.opts.turn.data(),r=this.width(),u=this.height(),e,f;switch(t.effect){case"hard":n&&(t.wrapper.css({width:r,height:u}),t.fpage.css({width:r,height:u}),o.opts.gradients&&(t.ashadow.css({width:r,height:u}),t.bshadow.css({width:r,height:u})));break;case"sheet":n&&(e=Math.round(Math.sqrt(Math.pow(r,2)+Math.pow(u,2))),t.wrapper.css({width:e,height:e}),t.fwrapper.css({width:e,height:e}).children(":first-child").css({width:r,height:u}),t.fpage.css({width:r,height:u}),o.opts.gradients&&t.ashadow.css({width:r,height:u}),i._backGradient.call(this)&&t.bshadow.css({width:r,height:u}));t.parent.is(":visible")&&(f=d(t.parent[0]),t.fwrapper.css({top:f.top,left:f.left}),f=d(t.opts.turn[0]),t.fparent.css({top:-f.top,left:-f.left}));this.flip("z",t.opts["z-index"])}},_addPageWrapper:function(){var t=this.data().f,s=t.opts.turn.data(),r=this.parent(),u,e;if(t.parent=r,!t.wrapper)switch(t.effect){case"hard":u={};u[o+"transform-style"]="preserve-3d";u[o+"backface-visibility"]="hidden";t.wrapper=n("<div/>",f(0,0,2)).css(u).appendTo(r).prepend(this);t.fpage=n("<div/>",f(0,0,1)).css(u).appendTo(r);s.opts.gradients&&(t.ashadow=n("<div/>",f(0,0,0)).hide().appendTo(r),t.bshadow=n("<div/>",f(0,0,0)));break;case"sheet":var h=this.width(),c=this.height(),l=Math.round(Math.sqrt(Math.pow(h,2)+Math.pow(c,2)));t.fparent=t.opts.turn.data().fparent;t.fparent||(e=n("<div/>",{css:{"pointer-events":"none"}}).hide(),e.data().flips=0,e.css(f(0,0,"auto","visible").css).appendTo(t.opts.turn),t.opts.turn.data().fparent=e,t.fparent=e);this.css({position:"absolute",top:0,left:0,bottom:"auto",right:"auto"});t.wrapper=n("<div/>",f(0,0,this.css("z-index"))).appendTo(r).prepend(this);t.fwrapper=n("<div/>",f(r.offset().top,r.offset().left)).hide().appendTo(t.fparent);t.fpage=n("<div/>",f(0,0,0,"visible")).css({cursor:"default"}).appendTo(t.fwrapper);s.opts.gradients&&(t.ashadow=n("<div/>",f(0,0,1)).appendTo(t.fpage));i.setData.call(this,t)}i.resize.call(this,!0)},_fold:function(n){var t=this.data().f,it=t.opts.turn.data(),d=i._c.call(this,n.corner),f=this.width(),e=this.height();switch(t.effect){case"hard":n.x=n.corner=="l"?Math.min(Math.max(n.x,0),f*2):Math.max(Math.min(n.x,f),-f);var rt,ut,nt,bt,ht,kt=it.totalPages,ct=t.opts["z-index"]||kt,ti={overflow:"visible"},l=d.x?(d.x-n.x)/f:n.x/f,ft=l*90,lt=ft<90;switch(n.corner){case"l":bt="0% 50%";ht="100% 50%";lt?(rt=0,ut=t.opts.next-1>0,nt=1):(rt="100%",ut=t.opts.page+1<kt,nt=0);break;case"r":bt="100% 50%";ht="0% 50%";ft=-ft;f=-f;lt?(rt=0,ut=t.opts.next+1<kt,nt=0):(rt="-100%",ut=t.opts.page!=1,nt=1)}ti[o+"perspective-origin"]=ht;t.wrapper.transform("rotateY("+ft+"deg)translate3d(0px, 0px, "+(this.attr("depth")||0)+"px)",ht);t.fpage.transform("translateX("+f+"px) rotateY("+(180+ft)+"deg)",bt);t.parent.css(ti);lt?(l=-l+1,t.wrapper.css({zIndex:ct+1}),t.fpage.css({zIndex:ct})):(l=l-1,t.wrapper.css({zIndex:ct}),t.fpage.css({zIndex:ct+1}));it.opts.gradients&&(ut?t.ashadow.css({display:"",left:rt,backgroundColor:"rgba(0,0,0,"+.5*l+")"}).transform("rotateY(0deg)"):t.ashadow.hide(),t.bshadow.css({opacity:-l+1}),lt?t.bshadow.parent()[0]!=t.wrapper[0]&&t.bshadow.appendTo(t.wrapper):t.bshadow.parent()[0]!=t.fpage[0]&&t.bshadow.appendTo(t.fpage),k(t.bshadow,r(nt*100,0),r((-nt+1)*100,0),[[0,"rgba(0,0,0,0.3)"],[1,"rgba(0,0,0,0)"]],2));break;case"sheet":var at=this,et=0,ii=0,dt,y,w,vt,h,yt,ri,s=r(0,0),gt=r(0,0),u=r(0,0),ui=i._foldingPage.call(this),fi=Math.tan(ii),pt=it.opts.acceleration,ni=t.wrapper.height(),tt=n.corner.substr(0,1)=="t",b=n.corner.substr(1,1)=="l",ot=function(){var o=r(0,0),l=r(0,0),v,nt,rt,a;o.x=d.x?d.x-n.x:n.x;o.y=g?d.y?d.y-n.y:n.y:0;l.x=b?f-o.x/2:n.x+o.x/2;l.y=o.y/2;var t=p-Math.atan2(o.y,o.x),ct=t-Math.atan2(l.y,l.x),ut=Math.max(0,Math.sin(ct)*Math.sqrt(Math.pow(l.x,2)+Math.pow(l.y,2)));if(et=st(t),u=r(ut*Math.sin(t),ut*Math.cos(t)),t>p&&(u.x=u.x+Math.abs(u.y*o.y/o.x),u.y=0,Math.round(u.x*Math.tan(c-t))<e))return n.y=Math.sqrt(Math.pow(e,2)+2*l.x*o.x),tt&&(n.y=e-n.y),ot();t>p&&(v=c-t,nt=ni-e/Math.sin(v),s=r(Math.round(nt*Math.cos(v)),Math.round(nt*Math.sin(v))),b&&(s.x=-s.x),tt&&(s.y=-s.y));dt=Math.round(u.y/Math.tan(t)+u.x);var k=f-dt,ft=k*Math.cos(t*2),ht=k*Math.sin(t*2);return gt=r(Math.round(b?k-ft:dt+ft),Math.round(tt?ht:e-ht)),it.opts.gradients&&(h=k*Math.sin(t),rt=i._c2.call(at,n.corner),a=Math.sqrt(Math.pow(rt.x-n.x,2)+Math.pow(rt.y-n.y,2))/f,ri=Math.sin(p*(a>1?2-a:a)),yt=Math.min(a,1),vt=h>100?(h-100)/h:0,y=r(h*Math.sin(t)/f*100,h*Math.cos(t)/e*100),i._backGradient.call(at)&&(w=r(h*1.2*Math.sin(t)/f*100,h*1.2*Math.cos(t)/e*100),b||(w.x=100-w.x),tt||(w.y=100-w.y))),u.x=Math.round(u.x),u.y=Math.round(u.y),!0},wt=function(n,u,o,h){var c=["0","auto"],p=(f-ni)*o[0]/100,d=(e-ni)*o[1]/100,g={left:c[u[0]],top:c[u[1]],right:c[u[2]],bottom:c[u[3]]},nt={},rt=h!=90&&h!=-90?b?-1:1:0,l=o[0]+"% "+o[1]+"%";at.css(g).transform(v(h)+a(n.x+rt,n.y,pt),l);t.fpage.css(g).transform(v(h)+a(n.x+gt.x-s.x-f*o[0]/100,n.y+gt.y-s.y-e*o[1]/100,pt)+v((180/h-2)*h),l);t.wrapper.transform(a(-n.x+p-rt,-n.y+d,pt)+v(-h),l);t.fwrapper.transform(a(-n.x+s.x+p,-n.y+s.y+d,pt)+v(-h),l);it.opts.gradients&&(o[0]&&(y.x=100-y.x),o[1]&&(y.y=100-y.y),nt["box-shadow"]="0 0 20px rgba(0,0,0,"+.5*ri+")",ui.css(nt),k(t.ashadow,r(b?100:0,tt?0:100),r(y.x,y.y),[[vt,"rgba(0,0,0,0)"],[(1-vt)*.8+vt,"rgba(0,0,0,"+.2*yt+")"],[1,"rgba(255,255,255,"+.2*yt+")"]],3,ii),i._backGradient.call(at)&&k(t.bshadow,r(b?0:100,tt?0:100),r(w.x,w.y),[[.6,"rgba(0,0,0,0)"],[.8,"rgba(0,0,0,"+.3*yt+")"],[1,"rgba(0,0,0,0)"]],3))};switch(n.corner){case"tl":n.x=Math.max(n.x,1);ot();wt(u,[1,0,0,1],[100,0],et);break;case"tr":n.x=Math.min(n.x,f-1);ot();wt(r(-u.x,u.y),[0,0,0,1],[0,0],-et);break;case"bl":n.x=Math.max(n.x,1);ot();wt(r(u.x,-u.y),[1,1,0,0],[100,100],-et);break;case"br":n.x=Math.min(n.x,f-1);ot();wt(r(-u.x,-u.y),[0,1,1,0],[0,100],et)}}t.point=n},_moveFoldingPage:function(n){var t=this.data().f,f,o,s;if(t){var e=t.opts.turn,r=e.data(),u=r.pagePlace;n?(f=t.opts.next,u[f]!=t.opts.page&&(t.folding&&i._moveFoldingPage.call(this,!1),o=i._foldingPage.call(this),o.appendTo(t.fpage),u[f]=t.opts.page,t.folding=f),e.turn("update")):t.folding&&(r.pages[t.folding]?(s=r.pages[t.folding].data().f,r.pageObjs[t.folding].appendTo(s.wrapper)):r.pageWrap[t.folding]&&r.pageObjs[t.folding].appendTo(r.pageWrap[t.folding]),t.folding in u&&(u[t.folding]=t.folding),delete t.folding)}},_showFoldedPage:function(n,t){var h=i._foldingPage.call(this),u=this.data(),r=u.f,f=r.visible,o,s,e;if(h){if((!f||!r.point||r.point.corner!=n.corner)&&(o=r.status=="hover"||r.status=="peel"||r.opts.turn.data().mouseAction?n.corner:null,f=!1,y("start",this,[r.opts,o])=="prevented"))return!1;if(t?(s=this,e=r.point&&r.point.corner==n.corner?r.point:i._c.call(this,n.corner,1),this.animatef({from:[e.x,e.y],to:[n.x,n.y],duration:500,frame:function(t){n.x=Math.round(t[0]);n.y=Math.round(t[1]);i._fold.call(s,n)}})):(i._fold.call(this,n),u.effect&&!u.effect.turning&&this.animatef(!1)),!f)switch(r.effect){case"hard":r.visible=!0;i._moveFoldingPage.call(this,!0);r.fpage.show();r.opts.shadows&&r.bshadow.show();break;case"sheet":r.visible=!0;r.fparent.show().data().flips++;i._moveFoldingPage.call(this,!0);r.fwrapper.show();r.bshadow&&r.bshadow.show()}return!0}return!1},hide:function(){var n=this.data().f,t=n.opts.turn.data(),r=i._foldingPage.call(this);switch(n.effect){case"hard":t.opts.gradients&&(n.bshadowLoc=0,n.bshadow.remove(),n.ashadow.hide());n.wrapper.transform("");n.fpage.hide();break;case"sheet":--n.fparent.data().flips==0&&n.fparent.hide();this.css({left:0,top:0,right:"auto",bottom:"auto"}).transform("");n.wrapper.transform("");n.fwrapper.hide();n.bshadow&&n.bshadow.hide();r.transform("")}return n.visible=!1,this},hideFoldedPage:function(n){var u=this.data().f;if(u.point){var e=this,t=u.point,o=function(){u.point=null;u.status="";e.flip("hide");e.trigger("end",[u.opts,!1])};if(n){var f=i._c.call(this,t.corner),h=t.corner.substr(0,1)=="t",s=h?Math.min(0,t.y-f.y)/2:Math.max(0,t.y-f.y)/2,c=r(t.x,t.y+s),l=r(f.x,f.y-s);this.animatef({from:0,to:1,frame:function(n){var r=tt(t,c,l,f,n);t.x=r.x;t.y=r.y;i._fold.call(e,t)},complete:o,duration:800,hiding:!0})}else this.animatef(!1),o()}},turnPage:function(n){var f=this,t=this.data().f,e=t.opts.turn.data(),r,u;n={corner:t.corner?t.corner.corner:n||i._cAllowed.call(this)[0]};r=t.point||i._c.call(this,n.corner,t.opts.turn?e.opts.elevation:0);u=i._c2.call(this,n.corner);this.trigger("flip").animatef({from:0,to:1,frame:function(t){var e=tt(r,r,u,u,t);n.x=e.x;n.y=e.y;i._showFoldedPage.call(f,n)},complete:function(){f.trigger("end",[t.opts,!0])},duration:e.opts.duration,turning:!0});t.corner=null},moving:function(){return"effect"in this.data()},isTurning:function(){return this.flip("moving")&&this.data().effect.turning},corner:function(){return this.data().f.corner},_eventStart:function(n){var t=this.data().f,r=t.opts.turn;if(!t.corner&&!t.disabled&&!this.flip("isTurning")&&t.opts.page==r.data().pagePlace[t.opts.page]){if(t.corner=i._isIArea.call(this,n),t.corner&&i._foldingPage.call(this))return this.trigger("pressed",[t.point]),i._showFoldedPage.call(this,t.corner),!1;t.corner=null}},_eventMove:function(n){var t=this.data().f,u,r,f;t.disabled||(n=l?n.originalEvent.touches:[n],t.corner?(u=t.parent.offset(),t.corner.x=n[0].pageX-u.left,t.corner.y=n[0].pageY-u.top,i._showFoldedPage.call(this,t.corner)):t.hover&&!this.data().effect&&this.is(":visible")&&(r=i._isIArea.call(this,n[0]),r?(t.effect=="sheet"&&r.corner.length==2||t.effect=="hard")&&(t.status="hover",f=i._c.call(this,r.corner,t.opts.cornerSize/2),r.x=f.x,r.y=f.y,i._showFoldedPage.call(this,r,!0)):t.status=="hover"&&(t.status="",i.hideFoldedPage.call(this,!0))))},_eventEnd:function(){var n=this.data().f,t=n.corner;!n.disabled&&t&&y("released",this,[n.point||t])!="prevented"&&i.hideFoldedPage.call(this,!0);n.corner=null},disable:function(n){return i.setData.call(this,{disabled:n}),this},hover:function(n){return i.setData.call(this,{hover:n}),this},peel:function(t,r){var u=this.data().f,f;if(t){if(n.inArray(t,s.all)==-1)throw e("Corner "+t+" is not permitted");n.inArray(t,i._cAllowed.call(this))!=-1&&(f=i._c.call(this,t,u.opts.cornerSize/2),u.status="peel",i._showFoldedPage.call(this,{corner:t,x:f.x,y:f.y},r))}else u.status="",i.hideFoldedPage.call(this,r);return this}};window.requestAnim=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(n){window.setTimeout(n,1e3/60)}}();n.extend(n.fn,{flip:function(){return nt(n(this[0]),i,arguments)},turn:function(){return nt(n(this[0]),t,arguments)},transform:function(n,t){var i={};return t&&(i[o+"transform-origin"]=t),i[o+"transform"]=n,this.css(i)},animatef:function(t){var i=this.data(),r;if(i.effect&&i.effect.stop(),t){t.to.length||(t.to=[t.to]);t.from.length||(t.from=[t.from]);var f=[],u=t.to.length,e=!0,s=this,h=(new Date).getTime(),o=function(){var r,c,n;if(i.effect&&e){for(r=[],c=Math.min(t.duration,(new Date).getTime()-h),n=0;n<u;n++)r.push(i.effect.easing(1,c,t.from[n],f[n],t.duration));t.frame(u==1?r[0]:r);c==t.duration?(delete i.effect,s.data(i),t.complete&&t.complete()):window.requestAnim(o)}};for(r=0;r<u;r++)f.push(t.to[r]-t.from[r]);i.effect=n.extend({stop:function(){e=!1},easing:function(n,t,i,r,u){return r*Math.sqrt(1-(t=t/u-1)*t)+i}},t);this.data(i);o()}else delete i.effect}});n.isTouch=l;n.mouseEvents=h;n.cssPrefix=it;n.cssTransitionEnd=ct;n.findPos=d})(jQuery);